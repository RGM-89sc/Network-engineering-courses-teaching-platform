(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9ac2a53a"],{"0f79":function(e,t,a){"use strict";var s=a("2eb2"),n=a.n(s);n.a},"2eb2":function(e,t,a){},"64a4":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"resources-wrapper gray-bg"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.searchPanelShow,expression:"searchPanelShow"}],staticClass:"search-panel"},[s("div",{staticClass:"search-input"},[s("md-icon",{staticClass:"search",attrs:{name:"search"}}),s("input",{attrs:{type:"text",autofocus:"",placeholder:"搜索资源名称"},on:{change:function(t){e.searchValue=t.target.value},keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchResources(e)}}}),s("md-button",{staticClass:"btn-cancel",attrs:{type:"link"},on:{click:function(e){t.searchPanelShow=!1}}},[t._v("取消")])],1)]),s("Card",{attrs:{round:""}},[s("div",{staticClass:"header"},[s("span",{staticClass:"title"},[t._v("资源下载")]),s("div",{staticClass:"tool-bar"},[t.user&&1===t.user.userType?s("md-button",{staticClass:"search-btn1",attrs:{type:"link"},on:{click:function(t){e.uploadResource()}}},[t._v("上传")]):t._e(),s("md-button",{staticClass:"search-btn",attrs:{type:"link"},on:{click:function(e){t.searchPanelShow=!0}}},[t._v("搜索")])],1)]),0===t.resources.length?s("div",{staticClass:"no-resources"},[s("span",[t._v("暂无数据")])]):t._e(),t._l(t.resources,(function(e){return s("md-cell-item",{key:e.filename,attrs:{title:e.filename,arrow:"",brief:e.date,addon:/\.pdf$/i.test(e.filename)?"可预览":""},on:{click:function(a){(t.isOperateSelectorShow=!0)&&(t.currentFile=e)}}})})),s("div",{staticClass:"show-more"},[t.gotAllResources?t._e():s("span",{on:{click:t.showMore}},[t._v("显示更多")])])],2),s("md-selector",{attrs:{data:t.fileOperate,"max-height":"320px",title:"操作"},on:{choose:t.resourceOperate},model:{value:t.isOperateSelectorShow,callback:function(e){t.isOperateSelectorShow=e},expression:"isOperateSelectorShow"}})],1)},n=[],c=(a("7f7f"),a("75fc")),o=(a("a481"),a("386d"),a("3b2b"),a("ae8d")),i={data:function(){return{currentFile:{},searchPanelShow:!1,isOperateSelectorShow:!1,classify:"courseware",searchValue:"",search:"",loading:!0,allResources:[],skip:0,limit:15,gotAllResources:!1,uploadClassify:"courseware",uploading:!1,updated:0}},computed:{resources:function(){var e=this;return this.allResources.filter((function(t){return new RegExp(e.search,"i").test(t.filename)}))},uploadTip:function(){return"courseware"===this.classify?"请选择.pdf文件进行上传，.ppt/.pptx无法在线预览":"software"===this.classify?"请打包成单个文件后再上传":void 0},fileOperate:function(){var e;return e=/\.pdf$/i.test(this.currentFile.filename)?[{value:"preview",text:"在线预览"},{value:"download",text:"下载"}]:[{value:"download",text:"下载"}],1===this.user.userType&&e.push({value:"delete",text:"删除"}),e}},props:{user:{type:Object,default:{}}},created:function(){this.courseID=this.$route.params.course_id,this.getResources(this.classify)},methods:{searchResources:function(){this.search=this.searchValue,this.searchPanelShow=!1},resourceOperate:function(e){var t=e.value;if("preview"===t)this.$router.push({path:"/library/".concat(this.encodeFilename(this.currentFile.filename))});else if("download"===t){var a=document.createElement("a");a.href=this.currentFile.href,a.download=this.currentFile.filename,a.click()}else"delete"===t&&this.delResource(this.currentFile)},encodeFilename:function(e){return e.replace(/\+/g,"%2B").replace(/ /g,"-").replace(/\//g,"%2F").replace(/\?/g,"%3F").replace(/#/g,"%23").replace(/&/g,"%26").replace(/=/g,"%3D")},decodeFilename:function(e){return e.replace(/%2B/g,"+").replace(/%2F/g,"/").replace(/%3F/g,"?").replace(/%23/g,"#").replace(/%26/g,"&").replace(/%3D/g,"=")},showMore:function(){this.skip+=this.limit,this.getResources(this.classify)},getResources:function(e){var t=this;this.loading=!0;var a=this.courseID;console.log(e),this.$http.post("/api/getResources",{classify:e,courseID:a,skip:this.skip,limit:this.limit}).then((function(e){if(1===e.data.code){var s,n=e.data.data.map((function(e){return{filename:t.decodeFilename(e.filename),date:t.dateFormat(e.created),classify:e.classify,href:"".concat(t.$serverBaseUrl,"/static/").concat(e.classify,"/").concat(a,"/").concat(e.filename)}}));console.log(n),(s=t.allResources).push.apply(s,Object(c["a"])(n)),n.length<t.limit&&(t.gotAllResources=!0)}})).catch((function(e){console.log(e)})).finally((function(){t.loading=!1}))},delResource:function(e){var t=this;console.log(e);var a=this;this.$dialog.confirm({title:"提示",content:"此操作将从服务器删除该文件, 是否继续?",confirmText:"确定",onConfirm:function(){t.$http.post("/api/delResources",{classify:e.classify,filename:e.filename}).then((function(t){1===t.data.code&&a.$dialog.succeed({title:"删除成功",content:"".concat(e.filename,"已删除"),confirmText:"确定",onConfirm:function(){a.$router.push({path:"/emptyPage"})}})})).catch((function(e){console.log(e)}))}})},uploadResource:function(){var e=document.createElement("input");e.type="file";var t=this;e.addEventListener("change",(function(a){t.$dialog.confirm({title:"提示",content:"请确认是否上传文件：".concat(e.files[0].name),confirmText:"确定",onConfirm:function(){t.submitUpload(e.files[0])}})})),e.click()},submitUpload:function(e){var t=this;this.uploading=!0;var a=new FormData;a.append("file",e),a.append("classify",this.uploadClassify),a.append("courseID",this.courseID),this.$http.post("/api/uploadResources",a).then((function(a){1===a.data.code&&t.$dialog.succeed({title:"上传成功",content:"文件：".concat(e.name," 上传成功"),confirmText:"确定",onConfirm:function(){t.$router.push({path:"/emptyPage"})}}),0===a.data.code&&(t.uploading=!1,t.$dialog.failed({title:"上传失败",content:a.data.info,confirmText:"确定",onConfirm:function(){t.$router.push({path:"/emptyPage"})}})),-1===a.data.code&&(t.uploading=!1,t.$dialog.failed({title:"上传失败",content:"发生了错误导致上传失败",confirmText:"确定",onConfirm:function(){}}),console.log(a.data.errMsg))})).catch((function(e){console.log(e)}))},dateFormat:function(e){var t=new Date(e);return"".concat(t.getFullYear(),"-").concat(t.getMonth()+1,"-").concat(t.getDate())}},components:{Card:o["a"]}},r=i,l=(a("0f79"),a("2877")),u=Object(l["a"])(r,s,n,!1,null,"17a53307",null);t["default"]=u.exports}}]);
//# sourceMappingURL=chunk-9ac2a53a.23953599.js.map