{"version":3,"sources":["webpack:///./src/views/childrenViews/courseViews/PreviewCourseware.vue?2b90","webpack:///src/views/childrenViews/courseViews/PreviewCourseware.vue","webpack:///./src/views/childrenViews/courseViews/PreviewCourseware.vue?5175","webpack:///./src/views/childrenViews/courseViews/PreviewCourseware.vue","webpack:///./src/views/childrenViews/courseViews/PreviewCourseware.vue?7d0f"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","_s","$route","params","filename","pdfLoaded","_e","style","visibility","transform","ref","staticStyle","attrs","src","currentPage","on","pdfError","selectPen","model","value","callback","$$v","penColor","expression","penThickness","gotoPage","checkKeyCode","pageCount","readingProgress","prev","catalogueItemOffsetPage","_l","pageNumber","key","path","$event","changePage","refInFor","class","pageLoaded","next","staticRenderFns","data","loading","progress","currentOffset","needLoadPageNum","isDrawing","canvas","context","canvasOffset","canDraw","created","console","log","$loading","lock","text","spinner","background","then","hash","window","onresize","computed","offset","parseInt","watch","setTimeout","newValue","strokeStyle","newColor","lineWidth","newThickness","props","user","type","Object","default","methods","encodeFilename","decodeFilename","event","preventDefault","inputPageNum","getElementPosition","element","x","offsetLeft","y","offsetTop","offsetParent","startDrawing","beginPath","moveTo","stopDrawing","draw","lineTo","stroke","pageNum","err","components","pdf","PDFViewerSkeleton","component"],"mappings":"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","file":"js/chunk-224ad2ab.8e8c8911.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('span',{staticClass:\"filename\"},[_vm._v(_vm._s(_vm.$route.params.filename))]),(!_vm.pdfLoaded)?_c('PDFViewerSkeleton'):_vm._e(),_c('div',{staticClass:\"pdf-viewer\",style:({\n      visibility: _vm.pdfLoaded ? 'visible' : 'hidden',\n      transform: (\"translateY(\" + (_vm.pdfLoaded ? '0' : '-200%') + \")\")\n    })},[_c('el-row',{staticClass:\"pdf-main\"},[_c('pdf',{ref:\"pdf\",staticStyle:{\"background-color\":\"#eee\",\"display\":\"flex\",\"flex\":\"1\"},attrs:{\"src\":_vm.src,\"page\":_vm.currentPage},on:{\"error\":_vm.pdfError}})],1),_c('el-row',{staticClass:\"pdf-console\"},[_c('el-col',{staticClass:\"tools\",attrs:{\"span\":12}},[_c('i',{staticClass:\"el-icon-edit\",staticStyle:{\"display\":\"inline-block\",\"margin-left\":\"1rem\",\"cursor\":\"pointer\"},attrs:{\"title\":\"铅笔\"},on:{\"click\":_vm.selectPen}}),_c('el-color-picker',{staticStyle:{\"margin-left\":\"1rem\"},attrs:{\"size\":\"small\",\"title\":\"选择颜色\",\"predefine\":[\n            '#000',\n            '#FF0000',\n            '#ff8c00',\n            '#ffd700',\n            '#90ee90',\n            '#00ced1',\n            '#1e90ff',\n            '#c71585'\n          ]},model:{value:(_vm.penColor),callback:function ($$v) {_vm.penColor=$$v},expression:\"penColor\"}}),_c('div',{staticStyle:{\"box-sizing\":\"border-box\",\"display\":\"inline-block\",\"margin-left\":\"1rem\",\"padding\":\"0 15px\",\"width\":\"120px\"}},[_c('el-slider',{attrs:{\"min\":1,\"max\":10,\"title\":\"笔尖粗细\"},model:{value:(_vm.penThickness),callback:function ($$v) {_vm.penThickness=$$v},expression:\"penThickness\"}})],1)],1),_c('el-col',{staticClass:\"pagination\",attrs:{\"span\":3}},[_c('span',[_c('span',{attrs:{\"id\":\"currentPage\",\"contenteditable\":\"true\"},on:{\"blur\":_vm.gotoPage,\"keydown\":_vm.checkKeyCode}},[_vm._v(_vm._s(_vm.currentPage))]),_vm._v(\" / \"+_vm._s(_vm.pageCount)+\"\\n        \")])]),_c('el-col',{staticClass:\"reading-progress\",attrs:{\"span\":8}},[_c('el-progress',{attrs:{\"percentage\":_vm.readingProgress,\"show-text\":false}})],1)],1),_c('el-row',{staticClass:\"catalogue\"},[_c('div',{staticClass:\"prev\"},[_c('i',{staticClass:\"el-icon-arrow-left\",on:{\"click\":_vm.prev}})]),_c('div',{staticClass:\"catalogue-list-box\"},[_c('div',{staticClass:\"catalogue-list\",style:({\n            transform: (\"translateX(calc(-20% * \" + (_vm.catalogueItemOffsetPage - 1) + \"))\")\n          })},_vm._l((_vm.needLoadPageNum),function(pageNumber){return _c('a',{key:pageNumber,attrs:{\"href\":_vm.$route.path + '#' + pageNumber},on:{\"click\":function($event){return _vm.changePage(pageNumber)}}},[_c('pdf',{ref:\"catalogueItem\",refInFor:true,staticClass:\"catalogue-item\",class:{ 'catalogue-item-active': _vm.currentPage === pageNumber },attrs:{\"src\":_vm.src,\"page\":pageNumber},on:{\"page-loaded\":function($event){return _vm.pageLoaded(pageNumber)},\"error\":_vm.pdfError}})],1)}),0)]),_c('div',{staticClass:\"next\"},[_c('i',{staticClass:\"el-icon-arrow-right\",on:{\"click\":_vm.next}})])])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div>\r\n    <span class=\"filename\">{{ $route.params.filename }}</span>\r\n    <PDFViewerSkeleton v-if=\"!pdfLoaded\" />\r\n    <div\r\n      class=\"pdf-viewer\"\r\n      :style=\"{\r\n        visibility: pdfLoaded ? 'visible' : 'hidden',\r\n        transform: `translateY(${pdfLoaded ? '0' : '-200%'})`\r\n      }\"\r\n    >\r\n      <el-row class=\"pdf-main\">\r\n        <pdf\r\n          ref=\"pdf\"\r\n          :src=\"src\"\r\n          :page=\"currentPage\"\r\n          style=\"background-color: #eee;display: flex;flex: 1\"\r\n          @error=\"pdfError\"\r\n        ></pdf>\r\n        <!-- <span>{{currentPage}} / {{pageCount}}</span> -->\r\n      </el-row>\r\n      <el-row class=\"pdf-console\">\r\n        <el-col class=\"tools\" :span=\"12\">\r\n          <i\r\n            class=\"el-icon-edit\"\r\n            style=\"display: inline-block; margin-left: 1rem;cursor: pointer\"\r\n            title=\"铅笔\"\r\n            @click=\"selectPen\"\r\n          ></i>\r\n          <el-color-picker\r\n            size=\"small\"\r\n            title=\"选择颜色\"\r\n            v-model=\"penColor\"\r\n            :predefine=\"[\r\n              '#000',\r\n              '#FF0000',\r\n              '#ff8c00',\r\n              '#ffd700',\r\n              '#90ee90',\r\n              '#00ced1',\r\n              '#1e90ff',\r\n              '#c71585'\r\n            ]\"\r\n            style=\"margin-left: 1rem\"\r\n          ></el-color-picker>\r\n          <div\r\n            style=\"box-sizing: border-box; display: inline-block; margin-left: 1rem; padding: 0 15px; width: 120px; \"\r\n          >\r\n            <el-slider\r\n              v-model=\"penThickness\"\r\n              :min=\"1\"\r\n              :max=\"10\"\r\n              title=\"笔尖粗细\"\r\n            ></el-slider>\r\n          </div>\r\n          <!-- <el-input-number\r\n          size=\"small\"\r\n          v-model=\"currentPage\"\r\n          :min=\"1\"\r\n          :max=\"pageCount\"\r\n          style=\"margin-right: 1rem\"\r\n          ></el-input-number>-->\r\n        </el-col>\r\n        <el-col class=\"pagination\" :span=\"3\">\r\n          <span>\r\n            <span\r\n              id=\"currentPage\"\r\n              contenteditable=\"true\"\r\n              @blur=\"gotoPage\"\r\n              @keydown=\"checkKeyCode\"\r\n            >{{ currentPage }}</span> / {{ pageCount }}\r\n          </span>\r\n        </el-col>\r\n        <el-col class=\"reading-progress\" :span=\"8\">\r\n          <el-progress\r\n            :percentage=\"readingProgress\"\r\n            :show-text=\"false\"\r\n          ></el-progress>\r\n        </el-col>\r\n      </el-row>\r\n\r\n      <el-row class=\"catalogue\">\r\n        <div class=\"prev\">\r\n          <i class=\"el-icon-arrow-left\" @click=\"prev\"></i>\r\n        </div>\r\n        <div class=\"catalogue-list-box\">\r\n          <div\r\n            class=\"catalogue-list\"\r\n            :style=\"{\r\n              transform: `translateX(calc(-20% * ${catalogueItemOffsetPage - 1}))`\r\n            }\"\r\n          >\r\n            <a\r\n              :href=\"$route.path + '#' + pageNumber\"\r\n              v-for=\"pageNumber in needLoadPageNum\"\r\n              :key=\"pageNumber\"\r\n              @click=\"changePage(pageNumber)\"\r\n            >\r\n              <pdf\r\n                ref=\"catalogueItem\"\r\n                :src=\"src\"\r\n                :page=\"pageNumber\"\r\n                class=\"catalogue-item\"\r\n                :class=\"{ 'catalogue-item-active': currentPage === pageNumber }\"\r\n                @page-loaded=\"pageLoaded(pageNumber)\"\r\n                @error=\"pdfError\"\r\n              ></pdf>\r\n            </a>\r\n          </div>\r\n        </div>\r\n\r\n        <div class=\"next\">\r\n          <i class=\"el-icon-arrow-right\" @click=\"next\"></i>\r\n        </div>\r\n      </el-row>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport pdf from 'vue-pdf';\r\nimport PDFViewerSkeleton from '@/components/skeleton/PDFViewer';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      src: '',\r\n      loading: null,\r\n      currentPage: 1,\r\n      pageCount: 0,\r\n      progress: 0,\r\n      pdfLoaded: false,\r\n      currentOffset: 1,\r\n      needLoadPageNum: 1,\r\n\r\n      isDrawing: false,\r\n      canvas: null,\r\n      context: null,\r\n      canvasOffset: {},\r\n      canDraw: false,\r\n      penColor: '#000',\r\n      penThickness: 1\r\n    };\r\n  },\r\n  created() {\r\n    console.log(this.$route.params.filename)\r\n    this.src = pdf.createLoadingTask(\r\n      `${this.$serverBaseUrl}/static/courseware/${this.$route.params.course_id}/${this.$route.params.filename}`\r\n    )\r\n    console.log(this.src)\r\n    this.loading = this.$loading({\r\n      lock: true,\r\n      text: '正在绘制图像，请耐心等待',\r\n      spinner: 'el-icon-loading',\r\n      background: 'rgba(0, 0, 0, 0.7)'\r\n    });\r\n\r\n    this.src.then(pdf => {\r\n      this.pageCount = pdf.numPages;\r\n\r\n      // 默认先加载10页，文件少于10也则加载全部\r\n      if (this.pageCount <= 10) {\r\n        this.needLoadPageNum = this.pageCount\r\n      } else {\r\n        this.needLoadPageNum = 10\r\n      }\r\n\r\n      // 获取当前url hash，作为当前要加载的页面\r\n      const hash = this.$route.hash;\r\n      if (hash) {\r\n        this.currentPage = parseInt(hash.replace('#', ''));\r\n        this.currentOffset =\r\n          this.currentPage - (this.pageCount - this.currentPage) - 2;\r\n      }\r\n\r\n      window.onresize = () => {\r\n        // bug: 修正后的值依然错误，但canvasOffset确实被成功修改了的\r\n        this.canvasOffset = this.getElementPosition(this.canvas);\r\n      };\r\n    });\r\n  },\r\n  computed: {\r\n    catalogueItemOffsetPage() {\r\n      let offset = 1;\r\n      if (this.currentPage <= 3) {\r\n        // 前3张\r\n        // do nothing\r\n      }\r\n      if (this.currentPage > 3 && this.currentPage < this.pageCount - 1) {\r\n        // 中间\r\n        offset = this.currentPage - 2;\r\n        this.currentOffset = offset;\r\n      }\r\n      if (this.currentPage >= this.pageCount - 1) {\r\n        // 后两张\r\n        if (this.currentOffset > 3 && this.currentOffset < this.pageCount - 1) {\r\n          offset = this.pageCount - 4;\r\n        } else {\r\n          offset = this.currentOffset;\r\n        }\r\n      }\r\n      return offset;\r\n    },\r\n    readingProgress() {\r\n      return parseInt((this.currentPage / this.pageCount) * 100) || 0;\r\n    }\r\n  },\r\n  watch: {\r\n    needLoadPageNum (newValue) {\r\n      setTimeout(() => {\r\n        if (newValue + 1 < this.pageCount) {\r\n          this.needLoadPageNum++\r\n          console.log('继续加载' + this.needLoadPageNum + '页')\r\n        }\r\n      }, 200)\r\n    },\r\n    // currentPage(newPageNum, oldPageNum) {\r\n    //   if (this.$route.hash !== '#' + newPageNum) {\r\n    //     this.$router.push({\r\n    //       path: this.$route.params.filename,\r\n    //       hash: '#' + newPageNum\r\n    //     });\r\n    //   }\r\n\r\n    //   // 禁用涂鸦\r\n    //   this.canDraw = false;\r\n    // },\r\n\r\n    penColor(newColor, oldColor) {\r\n      this.context.strokeStyle = newColor;\r\n    },\r\n    penThickness(newThickness, oldThickness) {\r\n      this.context.lineWidth = newThickness;\r\n    }\r\n  },\r\n  props: {\r\n    user: {\r\n      type: Object,\r\n      default: {}\r\n    }\r\n  },\r\n  methods: {\r\n    encodeFilename(filename) {\r\n      return filename\r\n        .replace(/\\+/g, '%2B')\r\n        .replace(/ /g, '-')\r\n        .replace(/\\//g, '%2F')\r\n        .replace(/\\?/g, '%3F')\r\n        .replace(/#/g, '%23')\r\n        .replace(/&/g, '%26')\r\n        .replace(/=/g, '%3D');\r\n    },\r\n\r\n    decodeFilename(filename) {\r\n      return filename\r\n        .replace(/%2B/g, '+')\r\n        .replace(/%2F/g, '/')\r\n        .replace(/%3F/g, '?')\r\n        .replace(/%23/g, '#')\r\n        .replace(/%26/g, '&')\r\n        .replace(/%3D/g, '=');\r\n    },\r\n    checkKeyCode(event) {\r\n      // 禁止除左右方向键，退格，删除，数字0-9以外的键入\r\n      if (\r\n        event.keyCode === 8 ||\r\n        event.keyCode === 46 ||\r\n        event.keyCode === 37 ||\r\n        event.keyCode === 39\r\n      ) {\r\n        return null;\r\n      }\r\n      if (\r\n        (event.keyCode >= 96 && event.keyCode <= 105) ||\r\n        (event.keyCode >= 48 && event.keyCode <= 57)\r\n      ) {\r\n        return null;\r\n      }\r\n      event.preventDefault();\r\n    },\r\n    gotoPage(event) {\r\n      const inputPageNum = parseInt(event.target.innerText);\r\n      if (inputPageNum <= 0) {\r\n        this.currentPage = 1;\r\n      } else if (inputPageNum > 0 && inputPageNum < this.pageCount) {\r\n        this.currentPage = inputPageNum;\r\n      } else {\r\n        this.currentPage = this.pageCount;\r\n      }\r\n    },\r\n    getElementPosition(element) {\r\n      let x = 0,\r\n        y = 0;\r\n      while (element != null) {\r\n        x += element.offsetLeft;\r\n        y += element.offsetTop;\r\n        element = element.offsetParent;\r\n      }\r\n      return { x, y };\r\n    },\r\n    selectPen() {\r\n      this.canDraw = true;\r\n      this.context.strokeStyle = this.penColor;\r\n      this.context.lineWidth = this.penThickness;\r\n      this.canvasOffset = this.getElementPosition(this.canvas);\r\n    },\r\n    startDrawing(e) {\r\n      this.isDrawing = true;\r\n      // 创建一个新的绘图路径\r\n      this.context.beginPath();\r\n      // 把画笔移动到鼠标位置\r\n\r\n      this.context.moveTo(\r\n        e.pageX - this.canvasOffset.x,\r\n        e.pageY - this.canvasOffset.y\r\n      );\r\n    },\r\n    stopDrawing() {\r\n      this.isDrawing = false;\r\n    },\r\n    draw(e) {\r\n      if (this.isDrawing && this.canDraw) {\r\n        // 找到鼠标最新位置\r\n        const x = e.pageX - this.canvasOffset.x;\r\n        const y = e.pageY - this.canvasOffset.y;\r\n        // 画一条直线到鼠标最新位置\r\n        this.context.lineTo(x, y);\r\n        this.context.stroke();\r\n      }\r\n    },\r\n    prev() {\r\n      if (this.currentPage > 1) {\r\n        this.currentPage--;\r\n      } else {\r\n      }\r\n    },\r\n    next() {\r\n      if (this.currentPage < this.pageCount) {\r\n        this.currentPage++;\r\n      } else {\r\n      }\r\n    },\r\n    changePage(pageNumber) {\r\n      this.currentPage = pageNumber;\r\n    },\r\n    pageLoaded(pageNum) {\r\n      console.log('loaded page ' + pageNum)\r\n      const _needLoadPageNum = this.needLoadPageNum\r\n\r\n      this.progress = parseInt((pageNum / _needLoadPageNum/*this.pageCount*/) * 100);\r\n      if (this.pdfLoaded === false && this.progress === 100) {\r\n        setTimeout(() => {\r\n          if (this.needLoadPageNum + 1 <= this.pageCount) {\r\n            this.needLoadPageNum++\r\n            console.log('继续加载' + this.needLoadPageNum + '页')\r\n          }\r\n        }, 50 * _needLoadPageNum)\r\n\r\n        setTimeout(() => {\r\n          // annotationLayer层会覆盖canvas，事件无法被激活，所以隐藏\r\n          this.$refs.pdf.$refs.annotationLayer.style.display = 'none';\r\n          this.canvas = this.$refs.pdf.$refs.canvas;\r\n          this.context = this.canvas.getContext('2d');\r\n          this.canvas.onmousedown = this.startDrawing;\r\n          this.canvas.onmouseup = this.stopDrawing;\r\n          this.canvas.onmouseout = this.stopDrawing;\r\n          this.canvas.onmousemove = this.draw;\r\n\r\n          this.pdfLoaded = true;\r\n          this.$nextTick(() => {\r\n            this.loading.close();\r\n          });\r\n        }, 150 * _needLoadPageNum/*this.pageCount*/);\r\n      }\r\n    },\r\n    pdfError(err) {\r\n      console.log(err);\r\n    }\r\n  },\r\n  components: {\r\n    pdf,\r\n    PDFViewerSkeleton\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.filename {\r\n  display: block;\r\n  padding: 1rem;\r\n  text-align: center;\r\n  font-size: 1.4rem;\r\n}\r\n\r\n.pdf-main {\r\n  position: relative;\r\n  border: 1px solid #eee;\r\n}\r\n\r\n.pdf-console {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 1rem;\r\n  height: 2rem;\r\n  font-size: 1.5rem;\r\n  background-color: #f8f8f8;\r\n  border: 1px solid #eee;\r\n\r\n  .tools {\r\n    display: flex;\r\n    align-items: center;\r\n  }\r\n\r\n  .pagination {\r\n    font-size: 1rem;\r\n  }\r\n}\r\n\r\n.catalogue {\r\n  box-sizing: border-box;\r\n  display: flex;\r\n  overflow: hidden;\r\n  white-space: nowrap;\r\n  border: 1px solid #eee;\r\n\r\n  .prev,\r\n  .next {\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    width: 40px;\r\n    text-align: center;\r\n    vertical-align: middle;\r\n    font-size: 30px;\r\n    font-weight: bold;\r\n    background-color: #f1f1f1;\r\n\r\n    i {\r\n      cursor: pointer;\r\n    }\r\n  }\r\n\r\n  .catalogue-list-box {\r\n    overflow: hidden;\r\n    background-color: #eee;\r\n\r\n    .catalogue-list {\r\n      transition: all 0.5s ease;\r\n\r\n      .catalogue-item {\r\n        box-sizing: border-box;\r\n        display: inline-block;\r\n        width: 20%;\r\n        vertical-align: top;\r\n        border: 4px solid #fff;\r\n        background-color: #eee;\r\n      }\r\n\r\n      .catalogue-item-active {\r\n        border-color: #409eff;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PreviewCourseware.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PreviewCourseware.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./PreviewCourseware.vue?vue&type=template&id=57f27401&scoped=true&\"\nimport script from \"./PreviewCourseware.vue?vue&type=script&lang=js&\"\nexport * from \"./PreviewCourseware.vue?vue&type=script&lang=js&\"\nimport style0 from \"./PreviewCourseware.vue?vue&type=style&index=0&id=57f27401&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"57f27401\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PreviewCourseware.vue?vue&type=style&index=0&id=57f27401&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PreviewCourseware.vue?vue&type=style&index=0&id=57f27401&lang=scss&scoped=true&\""],"sourceRoot":""}