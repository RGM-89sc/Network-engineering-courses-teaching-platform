(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d4ecd17"],{"0cb4":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("span",{staticClass:"filename"},[e._v(e._s(e.$route.params.filename))]),e.pdfLoaded?e._e():n("PDFViewerSkeleton"),n("div",{staticClass:"pdf-viewer",style:{visibility:e.pdfLoaded?"visible":"hidden",transform:"translateY("+(e.pdfLoaded?"0":"-200%")+")"}},[n("el-row",{staticClass:"pdf-main"},[n("pdf",{ref:"pdf",staticStyle:{"background-color":"#eee"},attrs:{src:e.src,page:e.currentPage},on:{error:e.pdfError}}),n("span",[e._v(e._s(e.currentPage)+" / "+e._s(e.pageCount))])],1),n("el-row",{staticClass:"pdf-console"},[n("el-col",{staticClass:"tools",attrs:{span:12}},[n("i",{staticClass:"el-icon-edit",staticStyle:{display:"inline-block","margin-left":"1rem",cursor:"pointer"},attrs:{title:"铅笔"},on:{click:e.selectPen}}),n("el-color-picker",{staticStyle:{"margin-left":"1rem"},attrs:{size:"small",title:"选择颜色",predefine:["#000","#FF0000","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585"]},model:{value:e.penColor,callback:function(t){e.penColor=t},expression:"penColor"}}),n("div",{staticStyle:{"box-sizing":"border-box",display:"inline-block","margin-left":"1rem",padding:"0 15px",width:"120px"}},[n("el-slider",{attrs:{min:1,max:10,title:"笔尖粗细"},model:{value:e.penThickness,callback:function(t){e.penThickness=t},expression:"penThickness"}})],1),n("el-input-number",{staticStyle:{"margin-right":"1rem"},attrs:{size:"small",min:1,max:e.pageCount},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}})],1),n("el-col",{staticClass:"pagination",attrs:{span:3}},[n("span",[n("span",{attrs:{id:"currentPage",contenteditable:"true"},on:{blur:e.gotoPage,keydown:e.checkKeyCode}},[e._v("\n            "+e._s(e.currentPage)+"\n          ")]),e._v("\n          / "+e._s(e.pageCount)+"\n        ")])]),n("el-col",{staticClass:"reading-progress",attrs:{span:8}},[n("el-progress",{attrs:{percentage:e.readingProgress,"show-text":!1}})],1)],1),n("el-row",{staticClass:"catalogue"},[n("div",{staticClass:"prev"},[n("i",{staticClass:"el-icon-arrow-left",on:{click:e.prev}})]),n("div",{staticClass:"catalogue-list-box"},[n("div",{staticClass:"catalogue-list",style:{transform:"translateX(calc(-20% * "+(e.catalogueItemOffsetPage-1)+"))"}},e._l(e.pageCount,(function(t){return n("a",{key:t,attrs:{href:"#"+t},on:{click:function(n){return e.changePage(t)}}},[n("pdf",{ref:"catalogueItem",refInFor:!0,staticClass:"catalogue-item",class:{"catalogue-item-active":e.currentPage===t},attrs:{src:e.src,page:t},on:{"page-loaded":function(n){return e.pageLoaded(t)},error:e.pdfError}})],1)})),0)]),n("div",{staticClass:"next"},[n("i",{staticClass:"el-icon-arrow-right",on:{click:e.next}})])])],1)],1)},s=[],r=(n("a481"),n("858e")),i=n("e400"),o={data:function(){return{src:r["a"].createLoadingTask("".concat(this.$serverBaseUrl,"/static/courseware/").concat(this.$route.params.filename)),loading:null,currentPage:1,pageCount:0,progress:0,pdfLoaded:!1,currentOffset:1,isDrawing:!1,canvas:null,context:null,canvasOffset:{},canDraw:!1,penColor:"#000",penThickness:1}},created:function(){var e=this;this.loading=this.$loading({lock:!0,text:"正在绘制图像，请耐心等待",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),this.src.then((function(t){e.pageCount=t.numPages;var n=e.$route.hash;n&&(e.currentPage=parseInt(n.replace("#","")),e.currentOffset=e.currentPage-(e.pageCount-e.currentPage)-2),window.onresize=function(){e.canvasOffset=e.getElementPosition(e.canvas)}}))},computed:{catalogueItemOffsetPage:function(){var e=1;return this.currentPage,this.currentPage>3&&this.currentPage<this.pageCount-1&&(e=this.currentPage-2,this.currentOffset=e),this.currentPage>=this.pageCount-1&&(e=this.currentOffset>3&&this.currentOffset<this.pageCount-1?this.pageCount-4:this.currentOffset),e},readingProgress:function(){return parseInt(this.currentPage/this.pageCount*100)||0}},watch:{currentPage:function(e,t){this.$route.hash!=="#"+e&&this.$router.push({path:this.$route.params.filename,hash:"#"+e}),this.canDraw=!1},penColor:function(e,t){this.context.strokeStyle=e},penThickness:function(e,t){this.context.lineWidth=e}},props:{user:{type:Object,default:{}}},methods:{checkKeyCode:function(e){return 8===e.keyCode||46===e.keyCode||37===e.keyCode||39===e.keyCode?null:e.keyCode>=96&&e.keyCode<=105||e.keyCode>=48&&e.keyCode<=57?null:void e.preventDefault()},gotoPage:function(e){var t=parseInt(e.target.innerText);t<=0?this.currentPage=1:t>0&&t<this.pageCount?this.currentPage=t:this.currentPage=this.pageCount},getElementPosition:function(e){var t=0,n=0;while(null!=e)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return{x:t,y:n}},selectPen:function(){this.canDraw=!0,this.context.strokeStyle=this.penColor,this.context.lineWidth=this.penThickness,this.canvasOffset=this.getElementPosition(this.canvas)},startDrawing:function(e){this.isDrawing=!0,this.context.beginPath(),this.context.moveTo(e.pageX-this.canvasOffset.x,e.pageY-this.canvasOffset.y)},stopDrawing:function(){this.isDrawing=!1},draw:function(e){if(this.isDrawing&&this.canDraw){var t=e.pageX-this.canvasOffset.x,n=e.pageY-this.canvasOffset.y;this.context.lineTo(t,n),this.context.stroke()}},prev:function(){this.currentPage>1&&this.currentPage--},next:function(){this.currentPage<this.pageCount&&this.currentPage++},changePage:function(e){this.currentPage=e},pageLoaded:function(e){var t=this;this.progress=parseInt(e/this.pageCount*100),!1===this.pdfLoaded&&100===this.progress&&setTimeout((function(){t.$refs.pdf.$refs.annotationLayer.style.display="none",t.canvas=t.$refs.pdf.$refs.canvas,t.context=t.canvas.getContext("2d"),t.canvas.onmousedown=t.startDrawing,t.canvas.onmouseup=t.stopDrawing,t.canvas.onmouseout=t.stopDrawing,t.canvas.onmousemove=t.draw,t.pdfLoaded=!0,t.$nextTick((function(){t.loading.close()}))}),150*this.pageCount)},pdfError:function(e){console.log(e)}},components:{pdf:r["a"],PDFViewerSkeleton:i["a"]}},c=o,l=(n("633d"),n("2877")),u=Object(l["a"])(c,a,s,!1,null,"49ca87f6",null);t["default"]=u.exports},"23dd":function(e,t,n){},"633d":function(e,t,n){"use strict";var a=n("23dd"),s=n.n(a);s.a}}]);
//# sourceMappingURL=chunk-2d4ecd17.aa8a532c.js.map